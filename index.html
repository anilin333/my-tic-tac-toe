<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>çŸ¥ç•¥ã¨è¬€ç•¥ã®ã€‡Ã—ã‚²ãƒ¼ãƒ </title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: #000;
      display: flex;
      color: #fff;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }

    .board {
      display: grid;
      grid-template-columns: repeat(3, 200px);
      grid-template-rows: repeat(3, 200px);
      border: 5px solid #000;
    }

    .cell {
      border: 5px solid #fff;
      color: #fff;
      background: transparent;
      width: 200px;
      height: 200px;

      font-size: 120px;
      text-align: center;
      line-height: 200px;
      cursor: pointer;
    }

    .fade-out {
  opacity: 0.3;
}
#resetButton {
  margin-top: 30px;
  font-size: 24px;
  padding: 10px 30px;
  cursor: pointer;
  background: #222;
  color: #fff;
  border: 2px solid #fff;
}
#info {
  font-size: 24px;
  margin-bottom: 20px;
  font-weight: bold;
  text-align: center;
  color: #0ff;
}
.win {
  background-color: #4caf50; /* æ˜ã‚‹ã‚ã®ç·‘ã€å¥½ããªè‰²ã«å¤‰ãˆã¦OK */
  color: #fff;               /* æ–‡å­—ã‚’ç™½ãã—ã¦è¦‹ã‚„ã™ã */
}
.cell { transition: opacity 0.2s ease; }
.fade-out { opacity: 0.3; }
  </style>
  
</head>
<body>
    <div id="message">ï¼˜å›ç›®ã®æ”»æ’ƒã‹ã‚‰ï¼‘å›ç›®ã®æ”»æ’ƒãŒæ¶ˆãˆã¦ã„ããï¼</div>
    <div id="info">INFOã€€ã•ã‚ã€ã€‡ã®æ”»æ’ƒã ï¼ï¼</div>
  <div class="board">
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
  </div>
  <button id="resetButton">ãƒªã‚»ãƒƒãƒˆ</button>
<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();

  const info  = document.getElementById('info');
  const cells = Array.from(document.querySelectorAll('.cell'));
  const resetBtn = document.getElementById('resetButton');

  // ã‚¯ãƒªãƒƒã‚¯ â†’ ã‚µãƒ¼ãƒãƒ¼ã¸ã€Œã“ã®ãƒã‚¹æŠ¼ã—ãŸã‚ˆã€
  cells.forEach((cell, index) => {
    cell.addEventListener('click', () => {
      socket.emit('move', index); // â† ã‚¤ãƒ™ãƒ³ãƒˆåã¯ 'move'
    });
  });

  // ===== ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®é€šçŸ¥ã‚’æç”» =====
  socket.on('assigned', (symbol) => {
    console.log('ã‚ãªãŸã¯:', symbol);
  });

  socket.on('board', ({ board, current }) => {
    // åˆæœŸçŠ¶æ…‹/å†å…¥å®¤æ™‚ã®å…¨ä½“åæ˜ 
    cells.forEach((c, i) => {
      c.textContent = board[i] || '';
      c.classList.remove('fade-out','win');
    });
    info.textContent = `INFOã€€${current}ã®æ”»æ’ƒï¼ï¼`;
  });

  socket.on('turn', (current) => {
    info.textContent = `INFOã€€${current}ã®æ”»æ’ƒï¼ï¼`;
  });

  socket.on('update', ({ index, player }) => {
    // èª°ã‹ãŒç½®ã„ãŸ
    cells[index].textContent = player;
  });

  socket.on('remove', ({ index }) => {
    // ã€Œ8æ‰‹ç›®ä»¥é™ã¯æœ€å¤æ‰‹ã‚’æ¶ˆã™ã€
    const cell = cells[index];
    cell.textContent = '';
    cell.classList.remove('fade-out','win');
  });
  socket.on('markOldest', ({ index }) => {
  cells.forEach(c => c.classList.remove('fade-out'));
  cells[index].classList.add('fade-out');
});
socket.on('clearMarks', () => {
  cells.forEach(c => c.classList.remove('fade-out'));
});
socket.on('win', ({ winner, line }) => {
  line.forEach(i => cells[i].classList.add('win'));
  alert(`${winner} ã®å‹ã¡ï¼`);
  info.textContent = `ğŸ‰ ${winner} ã®å‹ã¡ï¼`;
});

  
  socket.on('draw', () => {
    info.textContent = 'å¼•ãåˆ†ã‘ï¼';
  });

  socket.on('reset', ({ board, current }) => {
    cells.forEach((c, i) => {
      c.textContent = '';
      c.classList.remove('fade-out','win');
    });
    info.textContent = `INFOã€€${current}ã®æ”»æ’ƒï¼ï¼`;
  });

  // æ‰‹å‹•ãƒªã‚»ãƒƒãƒˆï¼ˆä»»æ„ï¼‰
  resetBtn.addEventListener('click', () => {
    socket.emit('requestReset');

  });
  let mySymbol = null;
socket.on('assigned', (symbol) => {
  mySymbol = symbol;
  console.log('ã‚ãªãŸã¯:', symbol);
});
socket.on('turn', (current) => {
  const me = (current === mySymbol) ? 'ï¼ˆã‚ãªãŸã®ç•ªï¼‰' : '';
  info.textContent = `INFOã€€${current}ã®æ”»æ’ƒï¼ï¼ ${me}`;
});
  
</script>
</body>
</html>